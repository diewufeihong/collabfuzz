# Collaborative Fuzzing

## Design
In this cooperative framework, the fuzzers collaborate using a centralized
scheduler. 


# Components

The project consists of three parts: 1) the cooperative framework, 2) a scheduler, and 3) the drivers for the fuzzers.
In this framework, the scheduler selects input seeds to be scheduled on
different fuzzers, by communicating this over the fuzzer driver. At the same
time the centralized scheduler collects newly generated inputs from the
fuzzers, and repeats the loop.

## Cooperative framework
Communication happens over ZeroMQ. The seeds are send with a message consisting
of the fuzzer type ID and the seed (which contains the seed input and an
optional conditional to be solved).

## Scheduler
The scheduler component selects seed inputs from the global queue, evaluates
them, and schedules them to the fuzzers.

## Fuzzer drivers
The fuzzer drivers implement the communcation mechanisms with the centralized
scheduler. The communication happens over ZeroMQ.

# Docker setup
Th easiest way is to setup the framework using docker.

The setup consists of the following components:

- fuzzer-framework
- fuzzer-{afl,qsy,aflfast,fairfuzz..}-{target}
- fuzzer-generic-driver

## How to run:


1. Setup virtualenv 
    * ```virtualenv --python=python3 venv```
    * ```source venv/bin/activate```
2. Build the container docker images (+ install deps):
    * ```make all```
3. Install the ```collab_fuzz_xxx``` tools
    * ```cd runners && python setup.py install```
4. Test run (runs 1 afl instance and collab framework):
    * ```mkdir myrun && cd myrun && collab_fuzz_compose -f afl --scheduler=enfuzz -- base64 && docker-compose up```
    * To run with more fuzzers (2 afl + qsym + fairfuzz + aflfast): ```collab_fuzz_runner -f afl afl qsym fairfuzz aflfast --scheduler=enfuzz -- who```

Alternatively, to avoid the long building times, you can fetch the docker
images from a remote repo. For example `collab_fuzz_build --remote
sarek.osterlund.xyz --pull-reqs` to pull all images.


## Extra info
The ```afl__generic_driver``` runs in a container (fuzzer-generic-driver). This container needs to be privileged and mount ```/var/run/docker.sock```, such that it can control the container of the fuzzer to sync with.

### Docker settings
The logs generated by the containers might eat up a lot of space on your
machine. To avoid this, edit your `daemon.json` (typically `/etc/docker/daemon.json`) to contain something like:

```
{
    "log-level":        "error",
    "storage-driver":   "overlay2",
    "log-opts": {
	    "max-size": "512m"
    }
}
```
